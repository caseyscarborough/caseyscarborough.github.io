<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Benchmarking Your Ruby Code &middot; caseyscarborough.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/favicon.ico" type="image/png">

    <link href="/assets/stylesheets/app-7716a11c.css" rel="stylesheet" type="text/css" />
    <script src="/assets/javascripts/app-fe2cd146.js" type="text/javascript"></script>
</head>
    <body>

    <div id="wrap">
      <header class="navbar navbar-inverse navbar-fixed-top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".cs-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">CASEY SCARBOROUGH</a>
    </div>
    <nav class="collapse navbar-collapse cs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li><a href="/">Home</a></li>
        <li><a href="/about/">About</a></li>
        <li><a href="https://github.com/caseyscarborough" target="_blank">GitHub</a></li>
        <li><a href="/blog/">Blog</a></li>
        <li><a href="/activity/">Activity</a></li>
      </ul>
    </nav>
  </div>
</header>

      <div class="content">
        <br>
        <div class="container">
          <div class="row">
            <div class="col-md-2 hidden-sm"></div>
            <div class="col-md-8">
              <h2>Benchmarking Your Ruby Code</h2>
              <p class="meta">22 Jul 2013 &middot; By <a href="mailto:caseyscarborough@gmail.com">Casey Scarborough</a></p>

              <div class="post">
                <p>There will more than likely come a time where you&#39;ll want to benchmark a piece of code that you&#39;ve written, or you&#39;d like to make it faster. Ruby comes packed with a module in its standard library that is built for benchmarking your code. The module is intuitively named <code>Benchmark</code>, and I&#39;m going to go through a few examples of using it.</p>

<p>The first and simplest way to benchmark a piece of Ruby code is to use the <code>Benchmark#measure</code> method.</p>

<pre><code class="ruby">require &#39;benchmark&#39;

puts Benchmark.measure { 50_000.downto(1).inject(:*) }
</code></pre>

<p>This line will determine the amount of time to calculate 50,000 factorial on your machine. After running this, you should get an output similar to the following:</p>

<pre><code>1.690000   0.020000   1.710000 (  1.707248)
</code></pre>

<p>This shows the amount of user CPU time, system CPU time, the sum of the user and system CPU times, and the elapsed real time in seconds. Generally, you&#39;ll want to take a look at the far right number, as this shows the amount of time taken to perform the operation.</p>

<h3>Benchmarking with Reports</h3>

<p>Using the <code>Benchmark#measure</code> method is good for a quick benchmark on a simple piece of code, but typically you&#39;ll want to run multiple tests and compare the results. You can do this using the <code>Benchmark#bm</code> method.</p>

<pre><code>require &#39;benchmark&#39;

Benchmark.bm do |x|
  x.report { (1..6).reduce(:*) }
  x.report { 1.upto(6).inject(:*) }
  x.report { 6.downto(1).inject(:*) }
end
</code></pre>

<p>This will compare the multiple ways to calculate 50,000 factorial. You should receive an output similar to the following:</p>

<pre><code>       user     system      total        real
   1.110000   0.010000   1.120000 (  1.119566)
   1.050000   0.000000   1.050000 (  1.061835)
   1.150000   0.010000   1.160000 (  1.148309)
</code></pre>

<p>You can also create labels with the <code>Benchmark#bm</code> method to create a more readable output.</p>

<pre><code class="ruby">require &#39;benchmark&#39;

Benchmark.bm(7) do |x|
  x.report(&#39;range:&#39;)  { (1..6).reduce(:*) }
  x.report(&#39;upto:&#39;)   { 1.upto(6).inject(:*) }
  x.report(&#39;downto:&#39;) { 6.downto(1).inject(:*) }
end
</code></pre>

<p>This will give you the following format for your output:</p>

<pre><code>              user     system      total        real
range:    1.100000   0.000000   1.100000 (  1.103561)
upto:     1.060000   0.010000   1.070000 (  1.061857)
downto:   1.160000   0.010000   1.170000 (  1.173509)
</code></pre>

<h3>Combatting Garbage Collection</h3>

<p>Your benchmarks will likely differ for each run due to memory allocation costs and garbage collection. To combat this, the <code>Benchmark</code> library contains a method called <code>bmbm</code> which runs the test multiple times. Using the example from the documentation, you can see the differences between the benchmarks:</p>

<pre><code class="ruby">require &#39;benchmark&#39;

# Create an array of 1,000,000 random digits
array = (1..1000000).map { rand }

Benchmark.bmbm do |x|
  # Output the benchmark for sorting (destructive and non-destructive) the array
  x.report(&quot;sort!&quot;) { array.dup.sort! }
  x.report(&quot;sort&quot;)  { array.dup.sort  }
end
</code></pre>

<p>Your result should be similar to the following:</p>

<pre><code>Rehearsal -----------------------------------------
sort!   1.090000   0.000000   1.090000 (  1.098318)
sort    1.090000   0.010000   1.100000 (  1.099114)
-------------------------------- total: 2.190000sec

            user     system      total        real
sort!   1.080000   0.000000   1.080000 (  1.082621)
sort    1.090000   0.000000   1.090000 (  1.084570)
</code></pre>

<p>This will give you a more accurate representation of your benchmarks.</p>

<h3>Resources</h3>

<p><a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/benchmark/rdoc/Benchmark.html">Benchmark Documentation</a></p>

              </div>
              <br>
                <div class="comments">
                  <div id="disqus_thread"></div>
                  <script type="text/javascript">
                    var disqus_shortname = 'caseyscarboroughcom'; 
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                  </script>
                  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
  <div class="row">
    <div class="col-md-3 hidden-sm"></div>
    <div class="col-md-6">
      <div class="footer">
        <p class="pull-left icons">
          <a target="_blank" class="tooltip-link" title="Email" href="mailto:caseyscarborough@gmail.com"><i class="fa fa-envelope"></i></a>&nbsp;&nbsp;
          <a target="_blank" class="tooltip-link" title="GitHub" href="https://github.com/caseyscarborough/"><i class="fa fa-github"></i></a>&nbsp;&nbsp;
          <a target="_blank" class="tooltip-link" title="BitBucket" href="https://bitbucket.org/caseyscarborough/"><i class="fa fa-bitbucket"></i></a>&nbsp;&nbsp;
          <a target="_blank" class="tooltip-link" title="LinkedIn" href="https://linkedin.com/in/caseyscarborough"><i class="fa fa-linkedin"></i></a>&nbsp;&nbsp;
          <a target="_blank" class="tooltip-link" title="Google+" href="https://plus.google.com/103526747321763836028?rel=author"><i class="fa fa-google-plus"></i></a>
        </p>
        <p class="pull-right">
          <small class="meta">Contribute to this site on <a target="_blank" href="https://github.com/caseyscarborough/caseyscarborough.github.io">GitHub</a>.</small><br>
        </p>
      </div>
    </div>
  </div>
</div>
    </body>
</html>
