!function(t,e){"object"==typeof exports&&exports?module.exports=e:"function"==typeof define&&define.amd?define(e):t.Mustache=e}(this,function(){function t(t,e){return RegExp.prototype.test.call(t,e)}function e(e){return!t(v,e)}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(t){return String(t).replace(/[&<>"'\/]/g,function(t){return y[t]})}function i(t){this.string=t,this.tail=t,this.pos=0}function a(t,e){this.view=t,this.parent=e,this.clearCache()}function o(){this.clearCache()}function s(t){function e(t,e,r){if(!n[t]){var i=s(e);n[t]=function(t,e){return i(t,e,r)}}return n[t]}var n={};return function(n,r,i){for(var a,o,s="",c=0,u=t.length;u>c;++c)switch(a=t[c],a[0]){case"#":o=i.slice(a[3],a[5]),s+=n._section(a[1],r,o,e(c,a[4],i));break;case"^":s+=n._inverted(a[1],r,e(c,a[4],i));break;case">":s+=n._partial(a[1],r);break;case"&":s+=n._name(a[1],r);break;case"name":s+=n._escaped(a[1],r);break;case"text":s+=a[1]}return s}}function c(t){for(var e,n=[],r=n,i=[],a=0,o=t.length;o>a;++a)switch(e=t[a],e[0]){case"#":case"^":i.push(e),r.push(e),r=e[4]=[];break;case"/":var s=i.pop();s[5]=e[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(e)}return n}function u(t){for(var e,n,r=[],i=0,a=t.length;a>i;++i)e=t[i],"text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(n=e,r.push(e));return r}function l(t){return[new RegExp(n(t[0])+"\\s*"),new RegExp("\\s*"+n(t[1]))]}var p={};p.name="mustache.js",p.version="0.7.2",p.tags=["{{","}}"],p.Scanner=i,p.Context=a,p.Writer=o;var h=/\s*/,f=/\s+/,v=/\S/,g=/\s*=/,w=/\s*\}/,d=/#|\^|\/|>|\{|&|=|!/,m=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};p.escape=r,i.prototype.eos=function(){return""===this.tail},i.prototype.scan=function(t){var e=this.tail.match(t);return e&&0===e.index?(this.tail=this.tail.substring(e[0].length),this.pos+=e[0].length,e[0]):""},i.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return e},a.make=function(t){return t instanceof a?t:new a(t)},a.prototype.clearCache=function(){this._cache={}},a.prototype.push=function(t){return new a(t,this)},a.prototype.lookup=function(t){var e=this._cache[t];if(!e){if("."===t)e=this.view;else for(var n=this;n;){if(t.indexOf(".")>0){var r=t.split("."),i=0;for(e=n.view;e&&i<r.length;)e=e[r[i++]]}else e=n.view[t];if(null!=e)break;n=n.parent}this._cache[t]=e}return"function"==typeof e&&(e=e.call(this.view)),e},o.prototype.clearCache=function(){this._cache={},this._partialCache={}},o.prototype.compile=function(t,e){var n=this._cache[t];if(!n){var r=p.parse(t,e);n=this._cache[t]=this.compileTokens(r,t)}return n},o.prototype.compilePartial=function(t,e,n){var r=this.compile(e,n);return this._partialCache[t]=r,r},o.prototype.compileTokens=function(t,e){var n=s(t),r=this;return function(t,i){if(i)if("function"==typeof i)r._loadPartial=i;else for(var o in i)r.compilePartial(o,i[o]);return n(r,a.make(t),e)}},o.prototype.render=function(t,e,n){return this.compile(t)(e,n)},o.prototype._section=function(t,e,n,r){var i=e.lookup(t);switch(typeof i){case"object":if(m(i)){for(var a="",o=0,s=i.length;s>o;++o)a+=r(this,e.push(i[o]));return a}return i?r(this,e.push(i)):"";case"function":var c=this,u=function(t){return c.render(t,e)},l=i.call(e.view,n,u);return null!=l?l:"";default:if(i)return r(this,e)}return""},o.prototype._inverted=function(t,e,n){var r=e.lookup(t);return!r||m(r)&&0===r.length?n(this,e):""},o.prototype._partial=function(t,e){t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t));var n=this._partialCache[t];return n?n(e):""},o.prototype._name=function(t,e){var n=e.lookup(t);return"function"==typeof n&&(n=n.call(e.view)),null==n?"":String(n)},o.prototype._escaped=function(t,e){return p.escape(this._name(t,e))},p.parse=function(t,r){function a(){if(C&&!U)for(;x.length;)b.splice(x.pop(),1);else x=[];C=!1,U=!1}if(t=t||"",r=r||p.tags,"string"==typeof r&&(r=r.split(f)),2!==r.length)throw new Error("Invalid tags: "+r.join(", "));for(var o,s,v,m,y=l(r),_=new i(t),k=[],b=[],x=[],C=!1,U=!1;!_.eos();){if(o=_.pos,v=_.scanUntil(y[0]))for(var E=0,P=v.length;P>E;++E)m=v.charAt(E),e(m)?x.push(b.length):U=!0,b.push(["text",m,o,o+1]),o+=1,"\n"===m&&a();if(o=_.pos,!_.scan(y[0]))break;if(C=!0,s=_.scan(d)||"name",_.scan(h),"="===s)v=_.scanUntil(g),_.scan(g),_.scanUntil(y[1]);else if("{"===s){var j=new RegExp("\\s*"+n("}"+r[1]));v=_.scanUntil(j),_.scan(w),_.scanUntil(y[1]),s="&"}else v=_.scanUntil(y[1]);if(!_.scan(y[1]))throw new Error("Unclosed tag at "+_.pos);if("/"===s){if(0===k.length)throw new Error('Unopened section "'+v+'" at '+o);var S=k.pop();if(S[1]!==v)throw new Error('Unclosed section "'+S[1]+'" at '+o)}var A=[s,v,o,_.pos];if(b.push(A),"#"===s||"^"===s)k.push(A);else if("name"===s||"{"===s||"&"===s)U=!0;else if("="===s){if(r=v.split(f),2!==r.length)throw new Error("Invalid tags at "+o+": "+r.join(", "));y=l(r)}}var S=k.pop();if(S)throw new Error('Unclosed section "'+S[1]+'" at '+_.pos);return c(u(b))};var _=new o;return p.clearCache=function(){return _.clearCache()},p.compile=function(t,e){return _.compile(t,e)},p.compilePartial=function(t,e,n){return _.compilePartial(t,e,n)},p.compileTokens=function(t,e){return _.compileTokens(t,e)},p.render=function(t,e,n){return _.render(t,e,n)},p.to_html=function(t,e,n,r){var i=p.render(t,e,n);return"function"!=typeof r?i:void r(i)},p}());